/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@codemirror/search@6.5.11/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{getPanel as e,EditorView as t,showPanel as r,ViewPlugin as i,Decoration as n,runScopeHandlers as s}from"@codemirror/view";import{codePointAt as o,fromCodePoint as l,codePointSize as a,StateEffect as c,EditorSelection as h,EditorState as u,CharCategory as f,findClusterBreak as d,Prec as m,StateField as p,Facet as g,combineConfig as v,RangeSetBuilder as x}from"@codemirror/state";import b from"crelt";const y="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class w{constructor(e,t,r=0,i=e.length,n,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,i),this.bufferStart=r,this.normalize=n?e=>n(y(e)):y,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return o(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=l(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=a(e);let i=this.normalize(t);if(i.length)for(let e=0,n=r;;e++){let s=i.charCodeAt(e),o=this.match(s,n,this.bufferPos+this.bufferStart);if(e==i.length-1){if(o)return this.value=o,this;break}n==r&&e<t.length&&t.charCodeAt(e)==s&&n++}}}match(e,t,r){let i=null;for(let t=0;t<this.matches.length;t+=2){let n=this.matches[t],s=!1;this.query.charCodeAt(n)==e&&(n==this.query.length-1?i={from:this.matches[t+1],to:r}:(this.matches[t]++,s=!0)),s||(this.matches.splice(t,2),t-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?i={from:t,to:r}:this.matches.push(1,t)),i&&this.test&&!this.test(i.from,i.to,this.buffer,this.bufferStart)&&(i=null),i}}"undefined"!=typeof Symbol&&(w.prototype[Symbol.iterator]=function(){return this});const M={from:-1,to:-1,match:/.*/.exec("")},k="gm"+(null==/x/.unicode?"":"u");class S{constructor(e,t,r,i=0,n=e.length){if(this.text=e,this.to=n,this.curLine="",this.done=!1,this.value=M,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new L(e,t,r,i,n);this.re=new RegExp(t,k+((null==r?void 0:r.ignoreCase)?"i":"")),this.test=null==r?void 0:r.test,this.iter=e.iter();let s=e.lineAt(i);this.curLineStart=s.from,this.matchPos=W(e,i),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,i=r+t[0].length;if(this.matchPos=W(this.text,i+(r==i?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<i||r>this.value.to)&&(!this.test||this.test(r,i,t)))return this.value={from:r,to:i,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const q=new WeakMap;class C{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let i=q.get(e);if(!i||i.from>=r||i.to<=t){let i=new C(t,e.sliceString(t,r));return q.set(e,i),i}if(i.from==t&&i.to==r)return i;let{text:n,from:s}=i;return s>t&&(n=e.sliceString(t,s)+n,s=t),i.to<r&&(n+=e.sliceString(i.to,r)),q.set(e,new C(s,n)),new C(t,n.slice(t-s,r-s))}}class L{constructor(e,t,r,i,n){this.text=e,this.to=n,this.done=!1,this.value=M,this.matchPos=W(e,i),this.re=new RegExp(t,k+((null==r?void 0:r.ignoreCase)?"i":"")),this.test=null==r?void 0:r.test,this.flat=C.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let e=this.flat.from+t.index,r=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,r,t)))return this.value={from:e,to:r,match:t},this.matchPos=W(this.text,r+(e==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=C.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function W(e,t){if(t>=e.length)return t;let r,i=e.lineAt(t);for(;t<i.to&&(r=i.text.charCodeAt(t-i.from))>=56320&&r<57344;)t++;return t}function F(e){let r=String(e.state.doc.lineAt(e.state.selection.main.head).number),i=b("input",{class:"cm-textfield",name:"line",value:r});function n(){let r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(i.value);if(!r)return;let{state:n}=e,s=n.doc.lineAt(n.selection.main.head),[,o,l,a,c]=r,u=a?+a.slice(1):0,f=l?+l:s.number;if(l&&c){let e=f/100;o&&(e=e*("-"==o?-1:1)+s.number/n.doc.lines),f=Math.round(n.doc.lines*e)}else l&&o&&(f=f*("-"==o?-1:1)+s.number);let d=n.doc.line(Math.max(1,Math.min(n.doc.lines,f))),m=h.cursor(d.from+Math.max(0,Math.min(u,d.length)));e.dispatch({effects:[A.of(!1),t.scrollIntoView(m.from,{y:"center"})],selection:m}),e.focus()}return{dom:b("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:A.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),n())},onsubmit:e=>{e.preventDefault(),n()}},b("label",e.state.phrase("Go to line"),": ",i)," ",b("button",{class:"cm-button",type:"submit"},e.state.phrase("go")),b("button",{name:"close",onclick:()=>{e.dispatch({effects:A.of(!1)}),e.focus()},"aria-label":e.state.phrase("close"),type:"button"},["×"]))}}"undefined"!=typeof Symbol&&(S.prototype[Symbol.iterator]=L.prototype[Symbol.iterator]=function(){return this});const A=c.define(),D=p.define({create:()=>!0,update(e,t){for(let r of t.effects)r.is(A)&&(e=r.value);return e},provide:e=>r.from(e,(e=>e?F:null))}),R=t=>{let r=e(t,F);if(!r){let i=[A.of(!0)];null==t.state.field(D,!1)&&i.push(c.appendConfig.of([D,P])),t.dispatch({effects:i}),r=e(t,F)}return r&&r.dom.querySelector("input").select(),!0},P=t.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),E={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},I=g.define({combine:e=>v(e,E,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});function z(e){let t=[K,V];return e&&t.push(I.of(e)),t}const $=n.mark({class:"cm-selectionMatch"}),O=n.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function T(e,t,r,i){return!(0!=r&&e(t.sliceDoc(r-1,r))==f.Word||i!=t.doc.length&&e(t.sliceDoc(i,i+1))==f.Word)}const V=i.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(I),{state:r}=e,i=r.selection;if(i.ranges.length>1)return n.none;let s,o=i.main,l=null;if(o.empty){if(!t.highlightWordAroundCursor)return n.none;let e=r.wordAt(o.head);if(!e)return n.none;l=r.charCategorizer(o.head),s=r.sliceDoc(e.from,e.to)}else{let e=o.to-o.from;if(e<t.minSelectionLength||e>200)return n.none;if(t.wholeWords){if(s=r.sliceDoc(o.from,o.to),l=r.charCategorizer(o.head),!T(l,r,o.from,o.to)||!function(e,t,r,i){return e(t.sliceDoc(r,r+1))==f.Word&&e(t.sliceDoc(i-1,i))==f.Word}(l,r,o.from,o.to))return n.none}else if(s=r.sliceDoc(o.from,o.to),!s)return n.none}let a=[];for(let i of e.visibleRanges){let e=new w(r.doc,s,i.from,i.to);for(;!e.next().done;){let{from:i,to:s}=e.value;if((!l||T(l,r,i,s))&&(o.empty&&i<=o.from&&s>=o.to?a.push(O.range(i,s)):(i>=o.to||s<=o.from)&&a.push($.range(i,s)),a.length>t.maxMatches))return n.none}}return n.set(a)}},{decorations:e=>e.decorations}),K=t.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const Q=({state:e,dispatch:r})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:r}=e,i=h.create(r.ranges.map((t=>e.wordAt(t.head)||h.cursor(t.head))),r.mainIndex);return!i.eq(r)&&(t(e.update({selection:i})),!0)})({state:e,dispatch:r});let n=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=n)))return!1;let s=function(e,t){let{main:r,ranges:i}=e.selection,n=e.wordAt(r.head),s=n&&n.from==r.from&&n.to==r.to;for(let r=!1,n=new w(e.doc,t,i[i.length-1].to);;){if(n.next(),!n.done){if(r&&i.some((e=>e.from==n.value.from)))continue;if(s){let t=e.wordAt(n.value.from);if(!t||t.from!=n.value.from||t.to!=n.value.to)continue}return n.value}if(r)return null;n=new w(e.doc,t,0,Math.max(0,i[i.length-1].from-1)),r=!0}}(e,n);return!!s&&(r(e.update({selection:e.selection.addRange(h.range(s.from,s.to),!1),effects:t.scrollIntoView(s.to)})),!0)},B=g.define({combine:e=>v(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Me(e),scrollToMatch:e=>t.scrollIntoView(e)})});function G(e){return e?[B.of(e),We]:We}class N{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,k),!0}catch(e){return!1}}(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Z(this):new J(this)}getCursor(e,t=0,r){let i=e.doc?e:u.create({doc:e});return null==r&&(r=i.doc.length),this.regexp?U(this,i,t,r):H(this,i,t,r)}}class j{constructor(e){this.spec=e}}function H(e,t,r,i){return new w(t.doc,e.unquoted,r,i,e.caseSensitive?void 0:e=>e.toLowerCase(),e.wholeWord?(n=t.doc,s=t.charCategorizer(t.selection.main.head),(e,t,r,i)=>((i>e||i+r.length<t)&&(i=Math.max(0,e-2),r=n.sliceString(i,Math.min(n.length,t+2))),!(s(X(r,e-i))==f.Word&&s(Y(r,e-i))==f.Word||s(Y(r,t-i))==f.Word&&s(X(r,t-i))==f.Word))):void 0);var n,s}class J extends j{constructor(e){super(e)}nextMatch(e,t,r){let i=H(this.spec,e,r,e.doc.length).nextOverlapping();if(i.done){let r=Math.min(e.doc.length,t+this.spec.unquoted.length);i=H(this.spec,e,0,r).nextOverlapping()}return i.done||i.value.from==t&&i.value.to==r?null:i.value}prevMatchInRange(e,t,r){for(let i=r;;){let r=Math.max(t,i-1e4-this.spec.unquoted.length),n=H(this.spec,e,r,i),s=null;for(;!n.nextOverlapping().done;)s=n.value;if(s)return s;if(r==t)return null;i-=1e4}}prevMatch(e,t,r){let i=this.prevMatchInRange(e,0,t);return i||(i=this.prevMatchInRange(e,Math.max(0,r-this.spec.unquoted.length),e.doc.length)),!i||i.from==t&&i.to==r?null:i}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=H(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let n=H(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!n.next().done;)i(n.value.from,n.value.to)}}function U(e,t,r,i){return new S(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?(n=t.charCategorizer(t.selection.main.head),(e,t,r)=>!r[0].length||(n(X(r.input,r.index))!=f.Word||n(Y(r.input,r.index))!=f.Word)&&(n(Y(r.input,r.index+r[0].length))!=f.Word||n(X(r.input,r.index+r[0].length))!=f.Word)):void 0},r,i);var n}function X(e,t){return e.slice(d(e,t,!1),t)}function Y(e,t){return e.slice(t,d(e,t))}class Z extends j{nextMatch(e,t,r){let i=U(this.spec,e,r,e.doc.length).next();return i.done&&(i=U(this.spec,e,0,t).next()),i.done?null:i.value}prevMatchInRange(e,t,r){for(let i=1;;i++){let n=Math.max(t,r-1e4*i),s=U(this.spec,e,n,r),o=null;for(;!s.next().done;)o=s.value;if(o&&(n==t||o.from>n+10))return o;if(n==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,((t,r)=>{if("&"==r)return e.match[0];if("$"==r)return"$";for(let t=r.length;t>0;t--){let i=+r.slice(0,t);if(i>0&&i<e.match.length)return e.match[i]+r.slice(t)}return t}))}matchAll(e,t){let r=U(this.spec,e,0,e.doc.length),i=[];for(;!r.next().done;){if(i.length>=t)return null;i.push(r.value)}return i}highlight(e,t,r,i){let n=U(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));for(;!n.next().done;)i(n.value.from,n.value.to)}}const _=c.define(),ee=c.define(),te=p.define({create:e=>new ne(ge(e).create(),null),update(e,t){for(let r of t.effects)r.is(_)?e=new ne(r.value.create(),e.panel):r.is(ee)&&(e=new ne(e.query,r.value?pe:null));return e},provide:e=>r.from(e,(e=>e.panel))});function re(e){let t=e.field(te,!1);return t?t.query.spec:ge(e)}function ie(e){var t;return null!=(null===(t=e.field(te,!1))||void 0===t?void 0:t.panel)}class ne{constructor(e,t){this.query=e,this.panel=t}}const se=n.mark({class:"cm-searchMatch"}),oe=n.mark({class:"cm-searchMatch cm-searchMatch-selected"}),le=i.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(te))}update(e){let t=e.state.field(te);(t!=e.startState.field(te)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return n.none;let{view:r}=this,i=new x;for(let t=0,n=r.visibleRanges,s=n.length;t<s;t++){let{from:o,to:l}=n[t];for(;t<s-1&&l>n[t+1].from-500;)l=n[++t].to;e.highlight(r.state,o,l,((e,t)=>{let n=r.state.selection.ranges.some((r=>r.from==e&&r.to==t));i.add(e,t,n?oe:se)}))}return i.finish()}},{decorations:e=>e.decorations});function ae(e){return t=>{let r=t.state.field(te,!1);return r&&r.query.spec.valid?e(t,r):be(t)}}const ce=ae(((e,{query:t})=>{let{to:r}=e.state.selection.main,i=t.nextMatch(e.state,r,r);if(!i)return!1;let n=h.single(i.from,i.to),s=e.state.facet(B);return e.dispatch({selection:n,effects:[Ce(e,i),s.scrollToMatch(n.main,e)],userEvent:"select.search"}),xe(e),!0})),he=ae(((e,{query:t})=>{let{state:r}=e,{from:i}=r.selection.main,n=t.prevMatch(r,i,i);if(!n)return!1;let s=h.single(n.from,n.to),o=e.state.facet(B);return e.dispatch({selection:s,effects:[Ce(e,n),o.scrollToMatch(s.main,e)],userEvent:"select.search"}),xe(e),!0})),ue=ae(((e,{query:t})=>{let r=t.matchAll(e.state,1e3);return!(!r||!r.length)&&(e.dispatch({selection:h.create(r.map((e=>h.range(e.from,e.to)))),userEvent:"select.search.matches"}),!0)})),fe=({state:e,dispatch:t})=>{let r=e.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:i,to:n}=r.main,s=[],o=0;for(let t=new w(e.doc,e.sliceDoc(i,n));!t.next().done;){if(s.length>1e3)return!1;t.value.from==i&&(o=s.length),s.push(h.range(t.value.from,t.value.to))}return t(e.update({selection:h.create(s,o),userEvent:"select.search.matches"})),!0},de=ae(((e,{query:r})=>{let{state:i}=e,{from:n,to:s}=i.selection.main;if(i.readOnly)return!1;let o=r.nextMatch(i,n,n);if(!o)return!1;let l,a,c=o,u=[],f=[];c.from==n&&c.to==s&&(a=i.toText(r.getReplacement(c)),u.push({from:c.from,to:c.to,insert:a}),c=r.nextMatch(i,c.from,c.to),f.push(t.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+".")));let d=e.state.changes(u);return c&&(l=h.single(c.from,c.to).map(d),f.push(Ce(e,c)),f.push(i.facet(B).scrollToMatch(l.main,e))),e.dispatch({changes:d,selection:l,effects:f,userEvent:"input.replace"}),!0})),me=ae(((e,{query:r})=>{if(e.state.readOnly)return!1;let i=r.matchAll(e.state,1e9).map((e=>{let{from:t,to:i}=e;return{from:t,to:i,insert:r.getReplacement(e)}}));if(!i.length)return!1;let n=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:t.announce.of(n),userEvent:"input.replace.all"}),!0}));function pe(e){return e.state.facet(B).createPanel(e)}function ge(e,t){var r,i,n,s,o;let l=e.selection.main,a=l.empty||l.to>l.from+100?"":e.sliceDoc(l.from,l.to);if(t&&!a)return t;let c=e.facet(B);return new N({search:(null!==(r=null==t?void 0:t.literal)&&void 0!==r?r:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:null!==(i=null==t?void 0:t.caseSensitive)&&void 0!==i?i:c.caseSensitive,literal:null!==(n=null==t?void 0:t.literal)&&void 0!==n?n:c.literal,regexp:null!==(s=null==t?void 0:t.regexp)&&void 0!==s?s:c.regexp,wholeWord:null!==(o=null==t?void 0:t.wholeWord)&&void 0!==o?o:c.wholeWord})}function ve(t){let r=e(t,pe);return r&&r.dom.querySelector("[main-field]")}function xe(e){let t=ve(e);t&&t==e.root.activeElement&&t.select()}const be=e=>{let t=e.state.field(te,!1);if(t&&t.panel){let r=ve(e);if(r&&r!=e.root.activeElement){let i=ge(e.state,t.query.spec);i.valid&&e.dispatch({effects:_.of(i)}),r.focus(),r.select()}}else e.dispatch({effects:[ee.of(!0),t?_.of(ge(e.state,t.query.spec)):c.appendConfig.of(We)]});return!0},ye=t=>{let r=t.state.field(te,!1);if(!r||!r.panel)return!1;let i=e(t,pe);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:ee.of(!1)}),!0},we=[{key:"Mod-f",run:be,scope:"editor search-panel"},{key:"F3",run:ce,shift:he,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:ce,shift:he,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:ye,scope:"editor search-panel"},{key:"Mod-Shift-l",run:fe},{key:"Mod-Alt-g",run:R},{key:"Mod-d",run:Q,preventDefault:!0}];class Me{constructor(e){this.view=e;let t=this.query=e.state.field(te).query.spec;function r(e,t,r){return b("button",{class:"cm-button",name:e,onclick:t,type:"button"},r)}this.commit=this.commit.bind(this),this.searchField=b("input",{value:t.search,placeholder:ke(e,"Find"),"aria-label":ke(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=b("input",{value:t.replace,placeholder:ke(e,"Replace"),"aria-label":ke(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=b("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=b("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=b("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit}),this.dom=b("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,r("next",(()=>ce(e)),[ke(e,"next")]),r("prev",(()=>he(e)),[ke(e,"previous")]),r("select",(()=>ue(e)),[ke(e,"all")]),b("label",null,[this.caseField,ke(e,"match case")]),b("label",null,[this.reField,ke(e,"regexp")]),b("label",null,[this.wordField,ke(e,"by word")]),...e.state.readOnly?[]:[b("br"),this.replaceField,r("replace",(()=>de(e)),[ke(e,"replace")]),r("replaceAll",(()=>me(e)),[ke(e,"replace all")])],b("button",{name:"close",onclick:()=>ye(e),"aria-label":ke(e,"close"),type:"button"},["×"])])}commit(){let e=new N({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:_.of(e)}))}keydown(e){s(this.view,e,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?he:ce)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),de(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(_)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(B).top}}function ke(e,t){return e.state.phrase(t)}const Se=30,qe=/[\s\.,:;?!]/;function Ce(e,{from:r,to:i}){let n=e.state.doc.lineAt(r),s=e.state.doc.lineAt(i).to,o=Math.max(n.from,r-Se),l=Math.min(s,i+Se),a=e.state.sliceDoc(o,l);if(o!=n.from)for(let e=0;e<Se;e++)if(!qe.test(a[e+1])&&qe.test(a[e])){a=a.slice(e);break}if(l!=s)for(let e=a.length-1;e>a.length-Se;e--)if(!qe.test(a[e-1])&&qe.test(a[e])){a=a.slice(0,e);break}return t.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${n.number}.`)}const Le=t.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),We=[te,m.low(le),Le];export{S as RegExpCursor,w as SearchCursor,N as SearchQuery,ye as closeSearchPanel,ce as findNext,he as findPrevious,re as getSearchQuery,R as gotoLine,z as highlightSelectionMatches,be as openSearchPanel,me as replaceAll,de as replaceNext,G as search,we as searchKeymap,ie as searchPanelOpen,ue as selectMatches,Q as selectNextOccurrence,fe as selectSelectionMatches,_ as setSearchQuery};export default null;
