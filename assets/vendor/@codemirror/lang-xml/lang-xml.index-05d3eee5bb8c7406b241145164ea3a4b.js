/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@codemirror/lang-xml@6.1.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{parser as e}from"@lezer/xml";import{LRLanguage as t,indentNodeProp as n,foldNodeProp as l,bracketMatchingHandle as o,LanguageSupport as r,syntaxTree as a}from"@codemirror/language";import{EditorSelection as i}from"@codemirror/state";import{EditorView as s}from"@codemirror/view";function m(e,t){let n=t&&t.getChild("TagName");return n?e.sliceString(n.from,n.to):""}function p(e,t){let n=t&&t.firstChild;return n&&"OpenTag"==n.name?m(e,n):""}function c(e){for(let t=e&&e.parent;t;t=t.parent)if("Element"==t.name)return t;return null}class u{constructor(e,t,n){this.attrs=t,this.attrValues=n,this.children=[],this.name=e.name,this.completion=Object.assign(Object.assign({type:"type"},e.completion||{}),{label:this.name}),this.openCompletion=Object.assign(Object.assign({},this.completion),{label:"<"+this.name}),this.closeCompletion=Object.assign(Object.assign({},this.completion),{label:"</"+this.name+">",boost:2}),this.closeNameCompletion=Object.assign(Object.assign({},this.completion),{label:this.name+">"}),this.text=e.textContent?e.textContent.map((e=>({label:e,type:"text"}))):[]}}const f=/^[:\-\.\w\u00b7-\uffff]*$/;function g(e){return Object.assign(Object.assign({type:"property"},e.completion||{}),{label:e.name})}function d(e){return"string"==typeof e?{label:`"${e}"`,type:"constant"}:/^"/.test(e.label)?e:Object.assign(Object.assign({},e),{label:`"${e.label}"`})}function h(e,t){let n=[],l=[],o=Object.create(null);for(let e of t){let t=g(e);n.push(t),e.global&&l.push(t),e.values&&(o[e.name]=e.values.map(d))}let r=[],i=[],s=Object.create(null);for(let t of e){let e=l,a=o;t.attributes&&(e=e.concat(t.attributes.map((e=>"string"==typeof e?n.find((t=>t.label==e))||{label:e,type:"property"}:(e.values&&(a==o&&(a=Object.create(a)),a[e.name]=e.values.map(d)),g(e))))));let m=new u(t,e,a);s[m.name]=m,r.push(m),t.top&&i.push(m)}i.length||(i=r);for(let t=0;t<r.length;t++){let n=e[t],l=r[t];if(n.children)for(let e of n.children)s[e]&&l.children.push(s[e]);else l.children=r}return e=>{var t;let{doc:n}=e.state,u=function(e,t){var n;let l=a(e).resolveInner(t,-1),o=null;for(let e=l;!o&&e.parent;e=e.parent)"OpenTag"!=e.name&&"CloseTag"!=e.name&&"SelfClosingTag"!=e.name&&"MismatchedCloseTag"!=e.name||(o=e);if(o&&(o.to>t||o.lastChild.type.isError)){let e=o.parent;if("TagName"==l.name)return"CloseTag"==o.name||"MismatchedCloseTag"==o.name?{type:"closeTag",from:l.from,context:e}:{type:"openTag",from:l.from,context:c(e)};if("AttributeName"==l.name)return{type:"attrName",from:l.from,context:o};if("AttributeValue"==l.name)return{type:"attrValue",from:l.from,context:o};let n=l==o||"Attribute"==l.name?l.childBefore(t):l;return"StartTag"==(null==n?void 0:n.name)?{type:"openTag",from:t,context:c(e)}:"StartCloseTag"==(null==n?void 0:n.name)&&n.to<=t?{type:"closeTag",from:t,context:e}:"Is"==(null==n?void 0:n.name)?{type:"attrValue",from:t,context:o}:n?{type:"attrName",from:t,context:o}:null}if("StartCloseTag"==l.name)return{type:"closeTag",from:t,context:l.parent};for(;l.parent&&l.to==t&&!(null===(n=l.lastChild)||void 0===n?void 0:n.type.isError);)l=l.parent;return"Element"==l.name||"Text"==l.name||"Document"==l.name?{type:"tag",from:t,context:"Element"==l.name?l:c(l)}:null}(e.state,e.pos);if(!u||"tag"==u.type&&!e.explicit)return null;let{type:g,from:d,context:h}=u;if("openTag"==g){let e=i,t=p(n,h);if(t){let n=s[t];e=(null==n?void 0:n.children)||r}return{from:d,options:e.map((e=>e.completion)),validFor:f}}if("closeTag"==g){let l=p(n,h);return l?{from:d,to:e.pos+(">"==n.sliceString(e.pos,e.pos+1)?1:0),options:[(null===(t=s[l])||void 0===t?void 0:t.closeNameCompletion)||{label:l+">",type:"type"}],validFor:f}:null}if("attrName"==g){let e=s[m(n,h)];return{from:d,options:(null==e?void 0:e.attrs)||l,validFor:f}}if("attrValue"==g){let t=function(e,t,n){let l=t&&t.getChildren("Attribute").find((e=>e.from<=n&&e.to>=n)),o=l&&l.getChild("AttributeName");return o?e.sliceString(o.from,o.to):""}(n,h,d);if(!t)return null;let l=s[m(n,h)],r=((null==l?void 0:l.attrValues)||o)[t];return r&&r.length?{from:d,to:e.pos+('"'==n.sliceString(e.pos,e.pos+1)?1:0),options:r,validFor:/^"[^"]*"?$/}:null}if("tag"==g){let t=p(n,h),l=s[t],o=[],a=h&&h.lastChild;!t||a&&"CloseTag"==a.name&&m(n,a)==t||o.push(l?l.closeCompletion:{label:"</"+t+">",type:"type",boost:2});let c=o.concat(((null==l?void 0:l.children)||(h?r:i)).map((e=>e.openCompletion)));if(h&&(null==l?void 0:l.text.length)){let t=h.firstChild;t.to>e.pos-20&&!/\S/.test(e.state.sliceDoc(t.to,e.pos))&&(c=c.concat(l.text))}return{from:d,options:c,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}return null}}const b=t.define({name:"xml",parser:e.configure({props:[n.add({Element(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"OpenTag CloseTag SelfClosingTag":e=>e.column(e.node.from)+e.unit}),l.add({Element(e){let t=e.firstChild,n=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==n.name?n.from:e.to}:null}}),o.add({"OpenTag CloseTag":e=>e.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/$/}});function C(e={}){let t=[b.data.of({autocomplete:h(e.elements||[],e.attributes||[])})];return!1!==e.autoCloseTags&&t.push(v),new r(b,t)}function T(e,t,n=e.length){if(!t)return"";let l=t.firstChild,o=l&&l.getChild("TagName");return o?e.sliceString(o.from,Math.min(o.to,n)):""}const v=s.inputHandler.of(((e,t,n,l,o)=>{if(e.composing||e.state.readOnly||t!=n||">"!=l&&"/"!=l||!b.isActiveAt(e.state,t,-1))return!1;let r=o(),{state:s}=r,m=s.changeByRange((e=>{var t,n,o;let r,{head:m}=e,p=s.doc.sliceString(m-1,m)==l,c=a(s).resolveInner(m,-1);if(p&&">"==l&&"EndTag"==c.name){let l=c.parent;if("CloseTag"!=(null===(n=null===(t=l.parent)||void 0===t?void 0:t.lastChild)||void 0===n?void 0:n.name)&&(r=T(s.doc,l.parent,m))){return{range:e,changes:{from:m,to:m+(">"===s.doc.sliceString(m,m+1)?1:0),insert:`</${r}>`}}}}else if(p&&"/"==l&&"StartCloseTag"==c.name){let e=c.parent;if(c.from==m-2&&"CloseTag"!=(null===(o=e.lastChild)||void 0===o?void 0:o.name)&&(r=T(s.doc,e,m))){let e=m+(">"===s.doc.sliceString(m,m+1)?1:0),t=`${r}>`;return{range:i.cursor(m+t.length,-1),changes:{from:m,to:e,insert:t}}}}return{range:e}}));return!m.changes.empty&&(e.dispatch([r,s.update(m,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}));export{v as autoCloseTags,h as completeFromSchema,C as xml,b as xmlLanguage};export default null;
