/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@codemirror/lint@6.8.5/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{getPanel as e,EditorView as t,Decoration as i,hoverTooltip as o,showPanel as s,ViewPlugin as n,gutter as l,showTooltip as r,logException as a,WidgetType as c,GutterMarker as d}from"@codemirror/view";import{StateEffect as m,RangeSet as f,StateField as u,Facet as h,combineConfig as g,RangeSetBuilder as p}from"@codemirror/state";import v from"crelt";class w{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class b{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,o){let s=o.facet($).markerFilter;s&&(e=s(e,o));let n=e.slice().sort(((e,t)=>e.from-t.from||e.to-t.to)),l=new p,r=[],a=0;for(let e=0;;){let t,s,c=e==n.length?null:n[e];if(!c&&!r.length)break;for(r.length?(t=a,s=r.reduce(((e,t)=>Math.min(e,t.to)),c&&c.from>t?c.from:1e8)):(t=c.from,s=c.to,r.push(c),e++);e<n.length;){let i=n[e];if(i.from!=t||!(i.to>i.from||i.to==t)){s=Math.min(i.from,s);break}r.push(i),e++,s=Math.min(i.to,s)}let d=J(r);if(r.some((e=>e.from==e.to||e.from==e.to-1&&o.doc.lineAt(e.from).to==e.from)))l.add(t,t,i.widget({widget:new V(d),diagnostics:r.slice()}));else{let e=r.reduce(((e,t)=>t.markClass?e+" "+t.markClass:e),"");l.add(t,s,i.mark({class:"cm-lintRange cm-lintRange-"+d+e,diagnostics:r.slice(),inclusiveEnd:r.some((e=>e.to>s))}))}a=s;for(let e=0;e<r.length;e++)r[e].to<=a&&r.splice(e--,1)}let c=l.finish();return new b(c,t,k(c))}}function k(e,t=null,i=0){let o=null;return e.between(i,1e9,((e,i,{spec:s})=>{if(!(t&&s.diagnostics.indexOf(t)<0))if(o){if(s.diagnostics.indexOf(o.diagnostic)<0)return!1;o=new w(o.from,i,o.diagnostic)}else o=new w(e,i,t||s.diagnostics[0])})),o}function x(e,t){let i=t.pos,o=t.end||i,s=e.state.facet($).hideOn(e,i,o);if(null!=s)return s;let n=e.startState.doc.lineAt(t.pos);return!(!e.effects.some((e=>e.is(T)))&&!e.changes.touchesRange(n.from,Math.max(n.to,o)))}function y(e,t){return e.field(S,!1)?t:t.concat(m.appendConfig.of(se))}function C(e,t){return{effects:y(e,[T.of(t)])}}const T=m.define(),R=m.define(),A=m.define(),S=u.define({create:()=>new b(i.none,null,null),update(e,t){if(t.docChanged&&e.diagnostics.size){let i=e.diagnostics.map(t.changes),o=null,s=e.panel;if(e.selected){let s=t.changes.mapPos(e.selected.from,1);o=k(i,e.selected.diagnostic,s)||k(i,null,s)}!i.size&&s&&t.state.facet($).autoPanel&&(s=null),e=new b(i,s,o)}for(let i of t.effects)if(i.is(T)){let o=t.state.facet($).autoPanel?i.value.length?Z.open:null:e.panel;e=b.init(i.value,o,t.state)}else i.is(R)?e=new b(e.diagnostics,i.value?Z.open:null,e.selected):i.is(A)&&(e=new b(e.diagnostics,e.panel,i.value));return e},provide:e=>[s.from(e,(e=>e.panel)),t.decorations.from(e,(e=>e.diagnostics))]});function L(e){let t=e.field(S,!1);return t?t.diagnostics.size:0}const I=i.mark({class:"cm-lintRange cm-lintRange-active"});function M(e,t,i){let o,{diagnostics:s}=e.state.field(S),n=-1,l=-1;s.between(t-(i<0?1:0),t+(i>0?1:0),((e,s,{spec:r})=>{if(t>=e&&t<=s&&(e==s||(t>e||i>0)&&(t<s||i<0)))return o=r.diagnostics,n=e,l=s,!1}));let r=e.state.facet($).tooltipFilter;return o&&r&&(o=r(o,e.state)),o?{pos:n,end:l,above:e.state.doc.lineAt(n).to<l,create:()=>({dom:O(e,o)})}:null}function O(e,t){return v("ul",{class:"cm-tooltip-lint"},t.map((t=>q(e,t,!1))))}const P=t=>{let i=t.state.field(S,!1);i&&i.panel||t.dispatch({effects:y(t.state,[R.of(!0)])});let o=e(t,Z.open);return o&&o.dom.querySelector(".cm-panel-lint ul").focus(),!0},B=e=>{let t=e.state.field(S,!1);return!(!t||!t.panel)&&(e.dispatch({effects:R.of(!1)}),!0)},D=e=>{let t=e.state.field(S,!1);if(!t)return!1;let i=e.state.selection.main,o=t.diagnostics.iter(i.to+1);return!(!o.value&&(o=t.diagnostics.iter(0),!o.value||o.from==i.from&&o.to==i.to))&&(e.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0}),!0)},F=e=>{let{state:t}=e,i=t.field(S,!1);if(!i)return!1;let o,s,n,l,r=t.selection.main;return i.diagnostics.between(0,t.doc.length,((e,t)=>{t<r.to&&(null==o||o<e)&&(o=e,s=t),(null==n||e>n)&&(n=e,l=t)})),null!=n&&(null!=o||n!=r.from)&&(e.dispatch({selection:{anchor:null!=o?o:n,head:null!=s?s:l},scrollIntoView:!0}),!0)},j=[{key:"Mod-Shift-m",run:P,preventDefault:!0},{key:"F8",run:D}],z=n.fromClass(class{constructor(e){this.view=e,this.timeout=-1,this.set=!0;let{delay:t}=e.state.facet($);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){clearTimeout(this.timeout);let e=Date.now();if(e<this.lintTime-10)this.timeout=setTimeout(this.run,this.lintTime-e);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet($);t.length&&function(e,t,i){let o=[],s=-1;for(let n of e)n.then((i=>{o.push(i),clearTimeout(s),o.length==e.length?t(o):s=setTimeout((()=>t(o)),200)}),i)}(t.map((e=>Promise.resolve(e(this.view)))),(t=>{this.view.state.doc==e.doc&&this.view.dispatch(C(this.view.state,t.reduce(((e,t)=>e.concat(t)))))}),(e=>{a(this.view.state,e)}))}}update(e){let t=e.state.facet($);(e.docChanged||t!=e.startState.facet($)||t.needsRefresh&&t.needsRefresh(e))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}});const $=h.define({combine:e=>Object.assign({sources:e.map((e=>e.source)).filter((e=>null!=e))},g(e.map((e=>e.config)),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))});function E(e,t={}){return[$.of({source:e,config:t}),z,se]}function H(e){let t=e.plugin(z);t&&t.force()}function N(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let o=i[e];if(/[a-zA-Z]/.test(o)&&!t.some((e=>e.toLowerCase()==o.toLowerCase()))){t.push(o);continue e}}t.push("")}return t}function q(e,t,i){var o;let s=i?N(t.actions):[];return v("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},v("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(e):t.message),null===(o=t.actions)||void 0===o?void 0:o.map(((i,o)=>{let n=!1,l=o=>{if(o.preventDefault(),n)return;n=!0;let s=k(e.state.field(S).diagnostics,t);s&&i.apply(e,s.from,s.to)},{name:r}=i,a=s[o]?r.indexOf(s[o]):-1,c=a<0?r:[r.slice(0,a),v("u",r.slice(a,a+1)),r.slice(a+1)];return v("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${r}${a<0?"":` (access key "${s[o]})"`}.`},c)})),t.source&&v("div",{class:"cm-diagnosticSource"},t.source))}class V extends c{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return v("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class Y{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=q(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Z{constructor(e){this.view=e,this.items=[];this.list=v("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)B(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],o=N(i.actions);for(let s=0;s<o.length;s++)if(o[s].toUpperCase().charCodeAt(0)==t.keyCode){let t=k(this.view.state.field(S).diagnostics,i);t&&i.actions[s].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=v("div",{class:"cm-panel-lint"},this.list,v("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>B(this.view)},"Ã—")),this.update()}get selectedIndex(){let e=this.view.state.field(S).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(S),i=0,o=!1,s=null,n=new Set;for(e.between(0,this.view.state.doc.length,((e,l,{spec:r})=>{for(let e of r.diagnostics){if(n.has(e))continue;n.add(e);let l,r=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==e){r=t;break}r<0?(l=new Y(this.view,e),this.items.splice(i,0,l),o=!0):(l=this.items[r],r>i&&(this.items.splice(i,r-i),o=!0)),t&&l.diagnostic==t.diagnostic?l.dom.hasAttribute("aria-selected")||(l.dom.setAttribute("aria-selected","true"),s=l):l.dom.hasAttribute("aria-selected")&&l.dom.removeAttribute("aria-selected"),i++}}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();0==this.items.length&&(this.items.push(new Y(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{let i=t.height/this.list.offsetHeight;e.top<t.top?this.list.scrollTop-=(t.top-e.top)/i:e.bottom>t.bottom&&(this.list.scrollTop+=(e.bottom-t.bottom)/i)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=k(this.view.state.field(S).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:A.of(t)})}static open(e){return new Z(e)}}function _(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function U(e){return _(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const X=t.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:U("#d11")},".cm-lintRange-warning":{backgroundImage:U("orange")},".cm-lintRange-info":{backgroundImage:U("#999")},".cm-lintRange-hint":{backgroundImage:U("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function G(e){return"error"==e?4:"warning"==e?3:"info"==e?2:1}function J(e){let t="hint",i=1;for(let o of e){let e=G(o.severity);e>i&&(i=e,t=o.severity)}return t}class K extends d{constructor(e){super(),this.diagnostics=e,this.severity=J(e)}toDOM(e){let t=document.createElement("div");t.className="cm-lint-marker cm-lint-marker-"+this.severity;let i=this.diagnostics,o=e.state.facet(ne).tooltipFilter;return o&&(i=o(i,e.state)),i.length&&(t.onmouseover=()=>function(e,t,i){function o(){let o=e.elementAtHeight(t.getBoundingClientRect().top+5-e.documentTop);e.coordsAtPos(o.from)&&e.dispatch({effects:te.of({pos:o.from,above:!1,clip:!1,create:()=>({dom:O(e,i),getCoords:()=>t.getBoundingClientRect()})})}),t.onmouseout=t.onmousemove=null,function(e,t){let i=o=>{let s=t.getBoundingClientRect();if(!(o.clientX>s.left-10&&o.clientX<s.right+10&&o.clientY>s.top-10&&o.clientY<s.bottom+10)){for(let e=o.target;e;e=e.parentNode)if(1==e.nodeType&&e.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",i),e.state.field(ie)&&e.dispatch({effects:te.of(null)})}};window.addEventListener("mousemove",i)}(e,t)}let{hoverTime:s}=e.state.facet(ne),n=setTimeout(o,s);t.onmouseout=()=>{clearTimeout(n),t.onmouseout=t.onmousemove=null},t.onmousemove=()=>{clearTimeout(n),n=setTimeout(o,s)}}(e,t,i)),t}}function Q(e,t){let i=Object.create(null);for(let o of t){let t=e.lineAt(o.from);(i[t.from]||(i[t.from]=[])).push(o)}let o=[];for(let e in i)o.push(new K(i[e]).range(+e));return f.of(o,!0)}const W=l({class:"cm-gutter-lint",markers:e=>e.state.field(ee),widgetMarker:(e,t,i)=>{let o=[];return e.state.field(ee).between(i.from,i.to,((e,t,s)=>{e>i.from&&e<i.to&&o.push(...s.diagnostics)})),o.length?new K(o):null}}),ee=u.define({create:()=>f.empty,update(e,t){e=e.map(t.changes);let i=t.state.facet(ne).markerFilter;for(let o of t.effects)if(o.is(T)){let s=o.value;i&&(s=i(s||[],t.state)),e=Q(t.state.doc,s.slice(0))}return e}}),te=m.define(),ie=u.define({create:()=>null,update:(e,t)=>(e&&t.docChanged&&(e=x(t,e)?null:Object.assign(Object.assign({},e),{pos:t.changes.mapPos(e.pos)})),t.effects.reduce(((e,t)=>t.is(te)?t.value:e),e)),provide:e=>r.from(e)}),oe=t.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:_('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:_('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error":{content:_('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),se=[S,t.decorations.compute([S],(e=>{let{selected:t,panel:o}=e.field(S);return t&&o&&t.from!=t.to?i.set([I.range(t.from,t.to)]):i.none})),o(M,{hideOn:x}),X],ne=h.define({combine:e=>g(e,{hoverTime:300,markerFilter:null,tooltipFilter:null})});function le(e={}){return[ne.of(e),ee,W,oe,ie]}function re(e,t){let i=e.field(S,!1);if(i&&i.diagnostics.size){let e=[],o=[],s=-1;for(let n=f.iter([i.diagnostics]);;n.next()){for(let i=0;i<e.length;i++)(!n.value||n.value.spec.diagnostics.indexOf(e[i])<0)&&(t(e[i],o[i],s),e.splice(i,1),o.splice(i--,1));if(!n.value)break;for(let t of n.value.spec.diagnostics)e.indexOf(t)<0&&(e.push(t),o.push(n.from));s=n.to}}}export{B as closeLintPanel,L as diagnosticCount,re as forEachDiagnostic,H as forceLinting,le as lintGutter,j as lintKeymap,E as linter,D as nextDiagnostic,P as openLintPanel,F as previousDiagnostic,C as setDiagnostics,T as setDiagnosticsEffect};export default null;
